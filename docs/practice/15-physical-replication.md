# 15) Физическая репликация

1. Настройте синхронную репликацию
    - проверьте для экземпляра, запущенного в сервисе db, значения параметров `wal_level` и `max_wal_senders` в `pg_settings`
    - проверьте наличие правила для репликации в `pg_hba.conf`
    - войдите в консоль сервиса db_replica
    - остановите сервер с помощью `pg_ctl`
    - очистите его каталог с данными
    - запустите в консоли сервиса db_replica `pg_basebackup -h db -U replicator -D $PGDATA -R --checkpoint=fast`
    - запустите сервер в сервисе db_replica
    - узнайте имя кластера, развернутого в db_replica (`SHOW cluster_name;`)
    - установите для параметра `synchronous_standby_names` в класере сервиса db значение, соответствующее имени кластера сервиса db_replica
    - перечитайте конфигурацию db
    - проверьте состояние синхронной репликации (`SELECT sync_state FROM pg_stat_replication;`)
2. Проверьте блокировку COMMIT при остановленной синхронной реплике
    - откройте второе окно консоли и остановите сервис db_replica
    - в первом окне подключитесь к psql сервиса db и попытайтесь выполнить транзакцию
    ```sql
    BEGIN;
    CREATE TABLE ...;
    INSERT ...;
    COMMIT;
    ```
    - во втором окне запустите сервис db_replica и СУБД в нем с помощью `pg_ctl`
    - наблюдайте поведение транзакции в первом окне

# Содержимое пояснительной записки
1. Скриншоты с введенными командами, результатами их выполнения и развернутые комментарии к ним