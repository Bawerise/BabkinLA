# 14) Резервное копирование

1. Создайте базу данных и таблицу в ней
    - зайдите в psql сервиса db
    - создайте базу данных
    - создайте в ней таблицу с единственной колонкой типа `NUMERIC`
    - заполните таблицу данными
2. Сделайте логическую копию базы данных
    - зайдите в консоль сервиса db
    - воспользуйтесь утилитой pg_dump для создания логической копии в общий том `/backups`
3. Удалите базу данных
    - зайдите в psql сервиса db
    - удалите базу данных
4. Восстановите базу данных из копии
    - зайдите в консоль сервиса db
    - восстановите с помощью psql базу данных из дампа
    - зайдите в psql
    - проверьте содержимое таблицы
5. Создайте физическую автономную резервную копию
    - создайте роль `replicator` с правом репликации и паролем
    ```psql
    CREATE ROLE replicator REPLICATION LOGIN PASSWORD '...';
    ```
    - в файл конфигурации `config/pg_hba.conf` добавьте строку
    `host    replication    replicator    0.0.0.0/0    scram-sha-256`
    - перечитайте конфигурацию в psql сервиса db (с помощью `pg_reload_conf`)
    - запустите сервис db_replica (`docker compose up -d db_replica`)
    - зайдите в консоль сервиса db_replica
    - удалите все содержимое каталога с данными (`/var/lib/postgresql/data/*`)
    - выполните копирование по сети из сервиса db
    ```bash
    pg_basebackup -h db -p 5432 -U replicator -W --pgdata=/var/lib/postgresql/data --checkpoint=fast -v
    ```
    - запустите PostgreSQL в сервисе db_replica
    ```bash
    pg_ctl -D /var/lib/postgresql/data -o "-c config_file=/etc/postgresql/postgresql.conf" -w start
    ```
    - проверьте, что СУБД работает
    ```bash
    pg_ctl -D /var/lib/postgresql/data status
    ```
    - зайдите в psql
    - проверьте содержимое таблицы

# Содержимое пояснительной записки
1. Скриншоты с введенными командами, результатами их выполнения и развернутые комментарии к ним